---
- name: Prepare the system for the all_in_one_scenario
  hosts: localhost
  tasks:
    - name: Check libvirt is present
      service:
        name: libvirtd
        state: started

    - name: Add user to qemu.conf
      lineinfile:
        path: /etc/libvirt/qemu.conf
        line: 'user = "redhat"'

    - name: Add group to qemu.conf
      lineinfile:
        path: /etc/libvirt/qemu.conf
        line: 'group = "crucible"'

    - name: Update firewall policies
      firewalld:
        permanent: yes
        masquerade: yes
        zone: public
        state: enabled

    - name: Restart firewalld service
      service:
        name: firewalld
        state: restarted